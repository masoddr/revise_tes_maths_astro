---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

// Types
type Theme = 'alg√®bre' | 'analyse' | 'probabilit√©s';
type ContentType = 'cours' | 'exercices';

interface ContentItem {
  titre: string;
  fichier: string;
  type: ContentType;
  theme: Theme;
}

// Mapping des contenus avec leurs th√®mes
const contenus: ContentItem[] = [
  // Cours - Analyse
  {
    titre: 'Fonction de r√©f√©rence',
    fichier: '/pdf/seconde/cours/Fonction_de_r√©f√©rence.pdf',
    type: 'cours',
    theme: 'analyse'
  },
  {
    titre: 'Fonctions affines',
    fichier: '/pdf/seconde/cours/Fonctions_affines.pdf',
    type: 'cours',
    theme: 'analyse'
  },
  {
    titre: '√âtude qualitative de fonctions',
    fichier: '/pdf/seconde/cours/√âtude_qualitative_de_fonctions.pdf',
    type: 'cours',
    theme: 'analyse'
  },
  {
    titre: 'G√©n√©ralit√©s sur les fonctions',
    fichier: '/pdf/seconde/cours/G√©n√©ralit√©s_sur_les_fonctions.pdf',
    type: 'cours',
    theme: 'analyse'
  },
  {
    titre: 'Pourcentage et taux d\'√©volution',
    fichier: '/pdf/seconde/cours/Pourcentage_et_taux_d\'√©volution.pdf',
    type: 'cours',
    theme: 'analyse'
  },
  {
    titre: 'Pourcentage et proportion',
    fichier: '/pdf/seconde/cours/Pourcentage_et_proportion.pdf',
    type: 'cours',
    theme: 'analyse'
  },
  // Cours - Alg√®bre
  {
    titre: 'Syst√®me d\'√©quations',
    fichier: '/pdf/seconde/cours/Syst√®me d\'√©quations.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: 'Equations de droites',
    fichier: '/pdf/seconde/cours/Equations de droites.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: '√âquations et In√©quations 2',
    fichier: '/pdf/seconde/cours/√âquations_et_In√©quations_2.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: 'Calcul vectoriel - Colin√©arit√©',
    fichier: '/pdf/seconde/cours/Calcul_vectoriel_-_Colin√©arit√©.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: 'Projet√© orthogonal',
    fichier: '/pdf/seconde/cours/Projet√©_orthogonal.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: 'In√©quations',
    fichier: '/pdf/seconde/cours/In√©quations.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: 'Expressions alg√©briques',
    fichier: '/pdf/seconde/cours/Expressions_alg√©briques.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: '√âquations',
    fichier: '/pdf/seconde/cours/√âquations.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: 'Rep√©rage dans le plan',
    fichier: '/pdf/seconde/cours/Rep√©rage_dans_le_plan.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: 'Configurations du plan et de l\'espace',
    fichier: '/pdf/seconde/cours/Configurations_du_plan_..._et_de_l\'espace.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: 'G√©n√©ralit√©s sur les vecteurs',
    fichier: '/pdf/seconde/cours/G√©n√©ralit√©s_sur_les_vecteurs.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: 'Nombres 1',
    fichier: '/pdf/seconde/cours/Nombres_1.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: 'Nombres 2',
    fichier: '/pdf/seconde/cours/Nombres_2.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: 'Nombres 3',
    fichier: '/pdf/seconde/cours/Nombres_3.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  // Cours - Probabilit√©s
  {
    titre: '√âchantillonnage',
    fichier: '/pdf/seconde/cours/√âchantillonnage.pdf',
    type: 'cours',
    theme: 'probabilit√©s'
  },
  {
    titre: 'Probabilit√©s',
    fichier: '/pdf/seconde/cours/Probabilit√©s.pdf',
    type: 'cours',
    theme: 'probabilit√©s'
  },
  {
    titre: 'Statistiques descriptives',
    fichier: '/pdf/seconde/cours/Statistiques_descriptives.pdf',
    type: 'cours',
    theme: 'probabilit√©s'
  },
  // Exercices - Analyse
  {
    titre: 'Fonction de r√©f√©rence',
    fichier: '/pdf/seconde/exercices/Exo - Fonction_de_r√©f√©rence.pdf',
    type: 'exercices',
    theme: 'analyse'
  },
  {
    titre: 'Fonctions affines',
    fichier: '/pdf/seconde/exercices/Exo - Fonctions_affines.pdf',
    type: 'exercices',
    theme: 'analyse'
  },
  {
    titre: '√âtude qualitative de fonctions',
    fichier: '/pdf/seconde/exercices/Exo - √âtude_qualitative_de_fonctions.pdf',
    type: 'exercices',
    theme: 'analyse'
  },
  {
    titre: 'G√©n√©ralit√©s sur les fonctions',
    fichier: '/pdf/seconde/exercices/Exo - G√©n√©ralit√©s_sur_les_fonctions.pdf',
    type: 'exercices',
    theme: 'analyse'
  },
  {
    titre: 'Pourcentage et taux d\'√©volution',
    fichier: '/pdf/seconde/exercices/Exo - Pourcentage_et_taux_d\'√©volution.pdf',
    type: 'exercices',
    theme: 'analyse'
  },
  {
    titre: 'Pourcentage, proportion et inclusion',
    fichier: '/pdf/seconde/exercices/Exo - Pourcentage,_proportion_et_inclusion.pdf',
    type: 'exercices',
    theme: 'analyse'
  },
  // Exercices - Alg√®bre
  {
    titre: 'Syst√®me d\'√©quation',
    fichier: '/pdf/seconde/exercices/Exo - Syst√®me_d\'√©quation.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: 'Equation de droite',
    fichier: '/pdf/seconde/exercices/Exo - Equation_de_droite.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: '√âquations et In√©quations 2',
    fichier: '/pdf/seconde/exercices/Exo - √âquations_et_In√©quations_2.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: 'Calcul vectoriel - Colin√©arit√©',
    fichier: '/pdf/seconde/exercices/Exo - Calcul_vectoriel_-_Colin√©arit√©.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: 'In√©quations',
    fichier: '/pdf/seconde/exercices/Exo - In√©quations.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: 'Expressions alg√©briques',
    fichier: '/pdf/seconde/exercices/Exo - Expressions_alg√©briques.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: '√âquations',
    fichier: '/pdf/seconde/exercices/Exo - √âquations.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: 'Rep√©rage dans le plan',
    fichier: '/pdf/seconde/exercices/Exo - Rep√©rage_dans_le_plan.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: 'G√©n√©ralit√©s sur les vecteurs',
    fichier: '/pdf/seconde/exercices/Exo - G√©n√©ralit√©s_sur_les_vecteurs.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: 'Nombres 1',
    fichier: '/pdf/seconde/exercices/Exo - Nombres_1.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: 'Nombres 2',
    fichier: '/pdf/seconde/exercices/Exo - Nombres_2.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: 'Nombres 3',
    fichier: '/pdf/seconde/exercices/Exo - Nombres_3.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  // Exercices - Probabilit√©s
  {
    titre: '√âchantillonnage',
    fichier: '/pdf/seconde/exercices/Exo - √âchantillonnage.pdf',
    type: 'exercices',
    theme: 'probabilit√©s'
  },
  {
    titre: 'Probabilit√©s',
    fichier: '/pdf/seconde/exercices/Exo - Probabilit√©s.pdf',
    type: 'exercices',
    theme: 'probabilit√©s'
  },
  {
    titre: 'Statistiques descriptives',
    fichier: '/pdf/seconde/exercices/Exo - Statistiques_descriptives.pdf',
    type: 'exercices',
    theme: 'probabilit√©s'
  }
];

// Theme colors mapping
const themeColors: Record<Theme, { bg: string; text: string; border: string }> = {
  'alg√®bre': {
    bg: 'bg-blue-50',
    text: 'text-blue-700',
    border: 'border-blue-200'
  },
  'analyse': {
    bg: 'bg-purple-50',
    text: 'text-purple-700',
    border: 'border-purple-200'
  },
  'probabilit√©s': {
    bg: 'bg-emerald-50',
    text: 'text-emerald-700',
    border: 'border-emerald-200'
  }
};
---

<Layout 
  title="Maths Seconde - Cours & exercices | revise-tes-maths.fr"
  description="Cours et exercices de math√©matiques pour la classe de Seconde. R√©visions et consolidation des bases."
>
  <Header />
  
  <!-- Hero Section -->
  <section class="relative bg-gradient-to-b from-blue-50 via-blue-50/50 to-white py-16 md:py-20 overflow-hidden">
    <!-- Background decorative elements -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <div class="absolute top-20 right-10 w-72 h-72 bg-cyan-200/30 rounded-full blur-3xl"></div>
      <div class="absolute bottom-10 right-20 w-96 h-96 bg-purple-200/20 rounded-full blur-3xl"></div>
      <div class="absolute top-1/2 left-10 w-64 h-64 bg-yellow-200/20 rounded-full blur-3xl"></div>
    </div>
    
    <div class="container mx-auto px-4 relative z-10">
      <div class="max-w-4xl mx-auto text-center">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6 tracking-tight">
          Math√©matiques - Seconde
        </h1>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto leading-relaxed">
          Parcourez nos cours et exercices par th√®me. Progressez √† votre rythme avec des contenus structur√©s et cibl√©s.
        </p>
      </div>
    </div>
  </section>
  
  <!-- Filters Section -->
  <section class="bg-white border-b border-gray-100 sticky top-0 z-10 backdrop-blur-sm bg-white/95">
    <div class="container mx-auto px-4 py-6">
      <div class="max-w-7xl mx-auto">
        <!-- Search Bar -->
        <div class="mb-6">
          <div class="relative max-w-md">
            <input
              type="text"
              id="search-input"
              placeholder="Rechercher un cours ou un exercice..."
              class="w-full px-4 py-2.5 pl-10 pr-4 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
            />
            <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>
        
        <div class="flex flex-col md:flex-row gap-6 items-start md:items-center justify-between">
          <!-- Type Filter -->
          <div class="flex flex-wrap gap-3 items-center">
            <span class="text-sm font-semibold text-gray-700">Type :</span>
            <div class="flex gap-2">
              <button 
                data-filter-type="all"
                class="filter-type-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-gray-900 text-white shadow-sm hover:bg-gray-800"
              >
                Tout
              </button>
              <button 
                data-filter-type="cours"
                class="filter-type-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"
              >
                üìñ Cours
              </button>
              <button 
                data-filter-type="exercices"
                class="filter-type-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"
              >
                ‚úèÔ∏è Exercices
              </button>
            </div>
          </div>
          
          <!-- Theme Filter -->
          <div class="flex flex-wrap gap-3 items-center">
            <span class="text-sm font-semibold text-gray-700">Th√®me :</span>
            <div class="flex gap-2">
              <button 
                data-filter-theme="all"
                class="filter-theme-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-gray-900 text-white shadow-sm hover:bg-gray-800"
              >
                Tous
              </button>
              <button 
                data-filter-theme="alg√®bre"
                class="filter-theme-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"
              >
                Alg√®bre
              </button>
              <button 
                data-filter-theme="analyse"
                class="filter-theme-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"
              >
                Analyse
              </button>
              <button 
                data-filter-theme="probabilit√©s"
                class="filter-theme-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"
              >
                Probabilit√©s
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Content Grid Section -->
  <section class="bg-white py-12 md:py-16">
    <div class="container mx-auto px-4">
      <div class="max-w-7xl mx-auto">
        <!-- Results count -->
        <div class="mb-8">
          <p class="text-gray-600">
            <span id="results-count" class="font-semibold text-gray-900">{contenus.length}</span> contenu{contenus.length > 1 ? 's' : ''} disponible{contenus.length > 1 ? 's' : ''}
          </p>
        </div>
        
        <!-- Content Grid -->
        <div id="content-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {contenus.map((contenu) => {
            const themeColor = themeColors[contenu.theme];
            return (
              <a
                href={contenu.fichier}
                target="_blank"
                rel="noopener noreferrer"
                data-type={contenu.type}
                data-theme={contenu.theme}
                class="content-card group block p-6 bg-white border border-gray-200 rounded-xl transition-all duration-300 hover:shadow-xl hover:shadow-gray-200/50 hover:-translate-y-1"
              >
                <div class="flex items-start gap-4">
                  <div class="text-3xl flex-shrink-0 filter drop-shadow-sm">
                    {contenu.type === 'cours' ? 'üìñ' : '‚úèÔ∏è'}
                  </div>
                  <div class="flex-1 min-w-0">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3 group-hover:text-blue-600 transition-colors leading-snug">
                      {contenu.titre}
                    </h3>
                    <div class="flex items-center gap-2 flex-wrap">
                      <span class={`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${themeColor.bg} ${themeColor.text} ${themeColor.border} border`}>
                        {contenu.theme}
                      </span>
                      <span class="text-xs text-gray-500 capitalize font-medium">
                        {contenu.type}
                      </span>
                    </div>
                  </div>
                </div>
              </a>
            );
          })}
        </div>
        
        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-16">
          <div class="text-6xl mb-4">üîç</div>
          <h3 class="text-xl font-semibold text-gray-900 mb-2">Aucun contenu trouv√©</h3>
          <p class="text-gray-600">Essayez de modifier vos filtres</p>
        </div>
      </div>
    </div>
  </section>
  
  <Footer />

  <script>
    // Get initial filter from URL params
    const urlParams = new URLSearchParams(window.location.search);
    const initialTypeFilter = urlParams.get('type') || 'all';
    
    // Filter state
    let currentTypeFilter = initialTypeFilter;
    let currentThemeFilter = 'all';
    let currentSearchQuery = '';

    // Get all elements
    const typeButtons = document.querySelectorAll('.filter-type-btn');
    const themeButtons = document.querySelectorAll('.filter-theme-btn');
    const contentCards = document.querySelectorAll('.content-card');
    const resultsCount = document.getElementById('results-count');
    const emptyState = document.getElementById('empty-state');
    const contentGrid = document.getElementById('content-grid');
    const searchInput = document.getElementById('search-input');

    // Update button styles
    function updateButtonStyles() {
      typeButtons.forEach(btn => {
        const filterValue = btn.getAttribute('data-filter-type');
        if (filterValue === currentTypeFilter) {
          btn.className = 'filter-type-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-gray-900 text-white shadow-sm hover:bg-gray-800';
        } else {
          btn.className = 'filter-type-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300';
        }
      });

      themeButtons.forEach(btn => {
        const filterValue = btn.getAttribute('data-filter-theme');
        if (filterValue === currentThemeFilter) {
          btn.className = 'filter-theme-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-gray-900 text-white shadow-sm hover:bg-gray-800';
        } else {
          btn.className = 'filter-theme-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300';
        }
      });
    }

    // Filter content
    function filterContent() {
      let visibleCount = 0;
      const searchQuery = currentSearchQuery.toLowerCase().trim();

      contentCards.forEach(card => {
        const cardType = card.getAttribute('data-type');
        const cardTheme = card.getAttribute('data-theme');
        const cardTitle = card.querySelector('h3')?.textContent?.toLowerCase() || '';
        
        const typeMatch = currentTypeFilter === 'all' || cardType === currentTypeFilter;
        const themeMatch = currentThemeFilter === 'all' || cardTheme === currentThemeFilter;
        const searchMatch = searchQuery === '' || cardTitle.includes(searchQuery);
        
        if (typeMatch && themeMatch && searchMatch) {
          card.classList.remove('hidden');
          visibleCount++;
        } else {
          card.classList.add('hidden');
        }
      });

      // Update results count
      if (resultsCount) {
        resultsCount.textContent = visibleCount.toString();
        const countText = visibleCount > 1 ? 's' : '';
        const parent = resultsCount.parentElement;
        if (parent) {
          parent.innerHTML = `<span id="results-count" class="font-semibold text-gray-900">${visibleCount}</span> contenu${countText} disponible${countText}`;
          // Re-attach reference
          const newResultsCount = document.getElementById('results-count');
          if (newResultsCount) {
            Object.assign(resultsCount, newResultsCount);
          }
        }
      }

      // Show/hide empty state
      if (emptyState && contentGrid) {
        if (visibleCount === 0) {
          emptyState.classList.remove('hidden');
          contentGrid.classList.add('hidden');
        } else {
          emptyState.classList.add('hidden');
          contentGrid.classList.remove('hidden');
        }
      }
    }

    // Type filter event listeners
    typeButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const filterValue = btn.getAttribute('data-filter-type');
        if (filterValue) {
          currentTypeFilter = filterValue;
          updateButtonStyles();
          filterContent();
        }
      });
    });

    // Theme filter event listeners
    themeButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const filterValue = btn.getAttribute('data-filter-theme');
        if (filterValue) {
          currentThemeFilter = filterValue;
          updateButtonStyles();
          filterContent();
        }
      });
    });

    // Search input event listener
    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        currentSearchQuery = (e.target as HTMLInputElement).value;
        filterContent();
      });
    }

    // Apply initial filter from URL
    if (initialTypeFilter !== 'all') {
      updateButtonStyles();
    }
    
    // Initial filter
    filterContent();
  </script>

  <style>
    .content-card {
      will-change: transform;
    }
    
    .content-card:hover {
      border-color: #d1d5db;
    }

    /* Smooth scroll behavior */
    html {
      scroll-behavior: smooth;
    }

    /* Filter buttons active state enhancement */
    .filter-type-btn:active,
    .filter-theme-btn:active {
      transform: scale(0.98);
    }
  </style>
</Layout>
