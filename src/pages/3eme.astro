---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

// Types
type Theme = 'alg√®bre' | 'analyse' | 'probabilit√©s';
type ContentType = 'cours' | 'exercices';

interface ContentItem {
  titre: string;
  fichier: string;
  type: ContentType;
  theme: Theme;
}

// Helper function to categorize content by theme
function categorizeTheme(titre: string): Theme {
  const titreLower = titre.toLowerCase();
  
  // Probabilit√©s
  if (titreLower.includes('probabilit√©') || titreLower.includes('statistique') || titreLower.includes('√©chantillonnage')) {
    return 'probabilit√©s';
  }
  
  // Analyse
  if (titreLower.includes('fonction') || titreLower.includes('trigonom√©trie') || titreLower.includes('calcul num√©rique')) {
    return 'analyse';
  }
  
  // Alg√®bre (default for geometry, equations, etc.)
  return 'alg√®bre';
}

// Mapping des contenus avec leurs th√®mes
const contenus: ContentItem[] = [
  // Cours
  {
    titre: '01. Nombres entiers',
    fichier: '/pdf/troisieme/cours/01. Nombres entiers.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: '02. Th√©or√®me de Thal√®s',
    fichier: '/pdf/troisieme/cours/02. Th√©or√®me de Thal√®s.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: '03. Calculs num√©riques',
    fichier: '/pdf/troisieme/cours/03. Calculs num√©riques.pdf',
    type: 'cours',
    theme: 'analyse'
  },
  {
    titre: '04. Statistiques',
    fichier: '/pdf/troisieme/cours/04. Statistiques.pdf',
    type: 'cours',
    theme: 'probabilit√©s'
  },
  {
    titre: '05. Trigonom√©trie',
    fichier: '/pdf/troisieme/cours/05. Trigonom√©trie.pdf',
    type: 'cours',
    theme: 'analyse'
  },
  {
    titre: '06. Notions de fonctions',
    fichier: '/pdf/troisieme/cours/06. Notions de fonctions.pdf',
    type: 'cours',
    theme: 'analyse'
  },
  {
    titre: '07. Expressions alg√©briques',
    fichier: '/pdf/troisieme/cours/07. Expressions algebriques.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: '08. Sections de solides',
    fichier: '/pdf/troisieme/cours/08. Sections de solides.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: '08. Espace - Sections de solides',
    fichier: '/pdf/troisieme/cours/08. Espace - sections de solides.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: '08. Espace - Aires et volumes',
    fichier: '/pdf/troisieme/cours/08. Espace - Aires et volumes.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: '09. Factorisation et Equation',
    fichier: '/pdf/troisieme/cours/09. Factoristion et Equation.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  {
    titre: '10. Probabilit√©s',
    fichier: '/pdf/troisieme/cours/10. Probabilit√©s.pdf',
    type: 'cours',
    theme: 'probabilit√©s'
  },
  {
    titre: '10. Proba',
    fichier: '/pdf/troisieme/cours/10. Proba.pdf',
    type: 'cours',
    theme: 'probabilit√©s'
  },
  {
    titre: '11. Fonctions lin√©aires',
    fichier: '/pdf/troisieme/cours/11. Fonctions lin√©aires.pdf',
    type: 'cours',
    theme: 'analyse'
  },
  {
    titre: '12. Triangles semblables',
    fichier: '/pdf/troisieme/cours/12. Triangles semblables.pdf',
    type: 'cours',
    theme: 'alg√®bre'
  },
  // Exercices
  {
    titre: '01. Nombres entiers',
    fichier: '/pdf/troisieme/exercices/01. Exo-Nombres entiers.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: '02. Th√©or√®me de Thal√®s',
    fichier: '/pdf/troisieme/exercices/02. Exo-Th√©or√®me de Thales.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: '03. Calculs num√©riques',
    fichier: '/pdf/troisieme/exercices/03. Exo-Calculs num√©riques.pdf',
    type: 'exercices',
    theme: 'analyse'
  },
  {
    titre: '03.1. Calculs num√©riques',
    fichier: '/pdf/troisieme/exercices/03.1. Exo-Calculs num√©riques.pdf',
    type: 'exercices',
    theme: 'analyse'
  },
  {
    titre: '03.2. Calculs num√©riques',
    fichier: '/pdf/troisieme/exercices/03.2. Exo-Calculs num√©riques.pdf',
    type: 'exercices',
    theme: 'analyse'
  },
  {
    titre: '03.3. Calculs num√©riques',
    fichier: '/pdf/troisieme/exercices/03.3. Exo-Calculs num√©riques.pdf',
    type: 'exercices',
    theme: 'analyse'
  },
  {
    titre: '04. Statistiques',
    fichier: '/pdf/troisieme/exercices/04. Exo-Statistiques.pdf',
    type: 'exercices',
    theme: 'probabilit√©s'
  },
  {
    titre: '05. Trigonom√©trie',
    fichier: '/pdf/troisieme/exercices/05. Exo-Trigonom√©trie.pdf',
    type: 'exercices',
    theme: 'analyse'
  },
  {
    titre: '06. Notion de fonctions',
    fichier: '/pdf/troisieme/exercices/06. Exo-Notion de fonctions.pdf',
    type: 'exercices',
    theme: 'analyse'
  },
  {
    titre: '06.1. Notion de fonctions',
    fichier: '/pdf/troisieme/exercices/06.1. Exo-Notion de fonctions.pdf',
    type: 'exercices',
    theme: 'analyse'
  },
  {
    titre: '06.2. Notion de fonctions',
    fichier: '/pdf/troisieme/exercices/06.2. Exo-Notion de fonctions.pdf',
    type: 'exercices',
    theme: 'analyse'
  },
  {
    titre: '07. Expressions alg√©briques',
    fichier: '/pdf/troisieme/exercices/07. Exo-Expressions alg√©briques.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: '08. Espaces - Sections de solides',
    fichier: '/pdf/troisieme/exercices/08. Exo-Espaces - Sections de solides.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: '09. Factorisation et Equation',
    fichier: '/pdf/troisieme/exercices/09. Exo-Factoristion et Equation.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  },
  {
    titre: '10. Probabilit√©s',
    fichier: '/pdf/troisieme/exercices/10. Exo-Probabilit√©s.pdf',
    type: 'exercices',
    theme: 'probabilit√©s'
  },
  {
    titre: '12. Triangles semblables',
    fichier: '/pdf/troisieme/exercices/12. Exo-Triangles semblables.pdf',
    type: 'exercices',
    theme: 'alg√®bre'
  }
];

// Theme colors mapping
const themeColors: Record<Theme, { bg: string; text: string; border: string }> = {
  'alg√®bre': {
    bg: 'bg-blue-50',
    text: 'text-blue-700',
    border: 'border-blue-200'
  },
  'analyse': {
    bg: 'bg-purple-50',
    text: 'text-purple-700',
    border: 'border-purple-200'
  },
  'probabilit√©s': {
    bg: 'bg-emerald-50',
    text: 'text-emerald-700',
    border: 'border-emerald-200'
  }
};
---

<Layout 
  title="Maths 3√®me - Cours & exercices | revise-tes-maths.fr"
  description="Cours et exercices de math√©matiques pour la classe de 3√®me. R√©visions et pr√©paration au brevet."
>
  <Header />
  
  <!-- Hero Section -->
  <section class="bg-gradient-to-b from-gray-50 via-white to-white py-16 md:py-20">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto text-center">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6 tracking-tight">
          Math√©matiques - 3√®me
        </h1>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto leading-relaxed">
          Parcourez nos cours et exercices par th√®me. Progressez √† votre rythme avec des contenus structur√©s et cibl√©s.
        </p>
      </div>
    </div>
  </section>
  
  <!-- Filters Section -->
  <section class="bg-white border-b border-gray-100 sticky top-0 z-10 backdrop-blur-sm bg-white/95">
    <div class="container mx-auto px-4 py-6">
      <div class="max-w-7xl mx-auto">
        <!-- Search Bar -->
        <div class="mb-6">
          <div class="relative max-w-md">
            <input
              type="text"
              id="search-input"
              placeholder="Rechercher un cours ou un exercice..."
              class="w-full px-4 py-2.5 pl-10 pr-4 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
            />
            <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>
        
        <div class="flex flex-col md:flex-row gap-6 items-start md:items-center justify-between">
          <!-- Type Filter -->
          <div class="flex flex-wrap gap-3 items-center">
            <span class="text-sm font-semibold text-gray-700">Type :</span>
            <div class="flex gap-2">
              <button 
                data-filter-type="all"
                class="filter-type-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-gray-900 text-white shadow-sm hover:bg-gray-800"
              >
                Tout
              </button>
              <button 
                data-filter-type="cours"
                class="filter-type-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"
              >
                üìñ Cours
              </button>
              <button 
                data-filter-type="exercices"
                class="filter-type-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"
              >
                ‚úèÔ∏è Exercices
              </button>
            </div>
          </div>
          
          <!-- Theme Filter -->
          <div class="flex flex-wrap gap-3 items-center">
            <span class="text-sm font-semibold text-gray-700">Th√®me :</span>
            <div class="flex gap-2">
              <button 
                data-filter-theme="all"
                class="filter-theme-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-gray-900 text-white shadow-sm hover:bg-gray-800"
              >
                Tous
              </button>
              <button 
                data-filter-theme="alg√®bre"
                class="filter-theme-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"
              >
                Alg√®bre
              </button>
              <button 
                data-filter-theme="analyse"
                class="filter-theme-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"
              >
                Analyse
              </button>
              <button 
                data-filter-theme="probabilit√©s"
                class="filter-theme-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300"
              >
                Probabilit√©s
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Content Grid Section -->
  <section class="bg-white py-12 md:py-16">
    <div class="container mx-auto px-4">
      <div class="max-w-7xl mx-auto">
        <!-- Results count -->
        <div class="mb-8">
          <p class="text-gray-600">
            <span id="results-count" class="font-semibold text-gray-900">{contenus.length}</span> contenu{contenus.length > 1 ? 's' : ''} disponible{contenus.length > 1 ? 's' : ''}
          </p>
        </div>
        
        <!-- Content Grid -->
        <div id="content-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {contenus.map((contenu) => {
            const themeColor = themeColors[contenu.theme];
            return (
              <a
                href={contenu.fichier}
                target="_blank"
                rel="noopener noreferrer"
                data-type={contenu.type}
                data-theme={contenu.theme}
                class="content-card group block p-6 bg-white border border-gray-200 rounded-xl transition-all duration-300 hover:shadow-xl hover:shadow-gray-200/50 hover:-translate-y-1"
              >
                <div class="flex items-start gap-4">
                  <div class="text-3xl flex-shrink-0 filter drop-shadow-sm">
                    {contenu.type === 'cours' ? 'üìñ' : '‚úèÔ∏è'}
                  </div>
                  <div class="flex-1 min-w-0">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3 group-hover:text-blue-600 transition-colors leading-snug">
                      {contenu.titre}
                    </h3>
                    <div class="flex items-center gap-2 flex-wrap">
                      <span class={`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${themeColor.bg} ${themeColor.text} ${themeColor.border} border`}>
                        {contenu.theme}
                      </span>
                      <span class="text-xs text-gray-500 capitalize font-medium">
                        {contenu.type}
                      </span>
                    </div>
                  </div>
                </div>
              </a>
            );
          })}
        </div>
        
        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-16">
          <div class="text-6xl mb-4">üîç</div>
          <h3 class="text-xl font-semibold text-gray-900 mb-2">Aucun contenu trouv√©</h3>
          <p class="text-gray-600">Essayez de modifier vos filtres</p>
        </div>
      </div>
    </div>
  </section>
  
  <Footer />

  <script>
    // Get initial filter from URL params
    const urlParams = new URLSearchParams(window.location.search);
    const initialTypeFilter = urlParams.get('type') || 'all';
    
    // Filter state
    let currentTypeFilter = initialTypeFilter;
    let currentThemeFilter = 'all';
    let currentSearchQuery = '';

    // Get all elements
    const typeButtons = document.querySelectorAll('.filter-type-btn');
    const themeButtons = document.querySelectorAll('.filter-theme-btn');
    const contentCards = document.querySelectorAll('.content-card');
    const resultsCount = document.getElementById('results-count');
    const emptyState = document.getElementById('empty-state');
    const contentGrid = document.getElementById('content-grid');
    const searchInput = document.getElementById('search-input');

    // Update button styles
    function updateButtonStyles() {
      typeButtons.forEach(btn => {
        const filterValue = btn.getAttribute('data-filter-type');
        if (filterValue === currentTypeFilter) {
          btn.className = 'filter-type-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-gray-900 text-white shadow-sm hover:bg-gray-800';
        } else {
          btn.className = 'filter-type-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300';
        }
      });

      themeButtons.forEach(btn => {
        const filterValue = btn.getAttribute('data-filter-theme');
        if (filterValue === currentThemeFilter) {
          btn.className = 'filter-theme-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-gray-900 text-white shadow-sm hover:bg-gray-800';
        } else {
          btn.className = 'filter-theme-btn px-5 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300';
        }
      });
    }

    // Filter content
    function filterContent() {
      let visibleCount = 0;
      const searchQuery = currentSearchQuery.toLowerCase().trim();

      contentCards.forEach(card => {
        const cardType = card.getAttribute('data-type');
        const cardTheme = card.getAttribute('data-theme');
        const cardTitle = card.querySelector('h3')?.textContent?.toLowerCase() || '';
        
        const typeMatch = currentTypeFilter === 'all' || cardType === currentTypeFilter;
        const themeMatch = currentThemeFilter === 'all' || cardTheme === currentThemeFilter;
        const searchMatch = searchQuery === '' || cardTitle.includes(searchQuery);
        
        if (typeMatch && themeMatch && searchMatch) {
          card.classList.remove('hidden');
          visibleCount++;
        } else {
          card.classList.add('hidden');
        }
      });

      // Update results count
      if (resultsCount) {
        resultsCount.textContent = visibleCount.toString();
        const countText = visibleCount > 1 ? 's' : '';
        const parent = resultsCount.parentElement;
        if (parent) {
          parent.innerHTML = `<span id="results-count" class="font-semibold text-gray-900">${visibleCount}</span> contenu${countText} disponible${countText}`;
          // Re-attach reference
          const newResultsCount = document.getElementById('results-count');
          if (newResultsCount) {
            Object.assign(resultsCount, newResultsCount);
          }
        }
      }

      // Show/hide empty state
      if (emptyState && contentGrid) {
        if (visibleCount === 0) {
          emptyState.classList.remove('hidden');
          contentGrid.classList.add('hidden');
        } else {
          emptyState.classList.add('hidden');
          contentGrid.classList.remove('hidden');
        }
      }
    }

    // Type filter event listeners
    typeButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const filterValue = btn.getAttribute('data-filter-type');
        if (filterValue) {
          currentTypeFilter = filterValue;
          updateButtonStyles();
          filterContent();
        }
      });
    });

    // Theme filter event listeners
    themeButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const filterValue = btn.getAttribute('data-filter-theme');
        if (filterValue) {
          currentThemeFilter = filterValue;
          updateButtonStyles();
          filterContent();
        }
      });
    });

    // Search input event listener
    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        currentSearchQuery = (e.target as HTMLInputElement).value;
        filterContent();
      });
    }

    // Apply initial filter from URL
    if (initialTypeFilter !== 'all') {
      updateButtonStyles();
    }
    
    // Initial filter
    filterContent();
  </script>

  <style>
    .content-card {
      will-change: transform;
    }
    
    .content-card:hover {
      border-color: #d1d5db;
    }

    /* Smooth scroll behavior */
    html {
      scroll-behavior: smooth;
    }

    /* Filter buttons active state enhancement */
    .filter-type-btn:active,
    .filter-theme-btn:active {
      transform: scale(0.98);
    }
  </style>
</Layout>
